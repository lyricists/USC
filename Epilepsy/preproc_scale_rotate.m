for i = 1:22
    try
        restoredefaultpath;
        addpath(genpath('/ImagePTE1/brainsuite/Woojae/Analysis/bfp/src'));

        fd = {'sn4055','sn4102','sn4214','sn4781','sn5097',...
            'sn6594','sn5579','sn5895','sn6012','sn6095',...
            'sn7256','sn7602','sn7915','sn7915_2','sn8002',...
            'sn8333','sn8252','sn8035','sn8133','sn8440',...
            'sn8556','sn8578'};

        T1 = {'Reslice_sn4055_constable_stack3d_S013_rotate.nii.gz',...
            'Reslice_sn4102_constable_stack3d_S013_rotate.nii.gz',...
            'Reslice_sn4214_constable_stack3d_S013_rotate.nii.gz',...
            'Reslice_sn4781_constable_stack3d_S015_rotate.nii.gz',...
            'Reslice_sn5097_constable_stack3d_S018_rotate.nii.gz',...
            'Reslice_sn6594_constable_stack3d_S017_rotate.nii.gz',...
            'Reslice_sn5579_constable_stack3d_S015_scale_rotate.nii.gz',...
            'Reslice_sn5895_constable_stack3d_S017_scale_rotate.nii.gz',...
            'Reslice_sn6012_constable_stack3d_S017_scale_rotate.nii.gz',...
            'Reslice_sn6095_constable_stack3d_S018_scale_rotate.nii.gz',...
            'Reslice_sn7256_constable_stack3d_S018_stripped_scale_rotate.nii.gz',...
            'Reslice_sn7602_constable_stack3d_S006_stripped_scale_rotate.nii.gz',...
            'Reslice_sn7915_constable_stack3d_S017_stripped_scale_rotate.nii.gz',...
            'Reslice_sn7915_constable_stack3d_S017_scale_rotate.nii.gz',...
            'Reslice_sn8002_constable_stack3d_S020_scale_rotate.nii.gz',...
            'Reslice_sn8333_constable_stack3d_S022_scale_rotate.nii.gz',...
            'Reslice_sn8252_constable_stack3d_S015_scale_rotate.nii.gz',...
            'Reslice_sn8035_constable_stack3d_S017_stripped_scale_rotate.nii.gz',...
            'Reslice_sn8133_constable_stack3d_S006_stripped_scale_rotate.nii.gz',...
            'Reslice_sn8440_constable_stack3d_S018_stripped_scale_rotate.nii.gz',...
            'Reslice_sn8556_constable_stack3d_S016_stripped_scale_rotate.nii.gz',...
            'Reslice_sn8578_constable_stack3d_S017_stripped_scale_rotate.nii.gz'};
            
        fMRI = {'sn4055_constable_stack4d_S015_rotate.nii.gz',...
            'sn4102_constable_stack4d_S016_rotate.nii.gz',...
            'sn4214_constable_stack4d_S015_rotate.nii.gz',...
            'sn4781_constable_stack4d_S017_rotate.nii.gz',...
            'sn5097_constable_stack4d_S019_rotate.nii.gz',...            
            'sn6594_constable_stack4d_S019_rotate.nii.gz',...        
            'sn5579_constable_stack4d_S017_rotate.nii.gz',...
            'sn5895_constable_stack4d_S019_rotate.nii.gz',...
            'sn6012_constable_stack4d_S019_rotate.nii.gz',...
            'sn6095_constable_stack4d_S020_rotate.nii.gz',...
            'sn7256_constable_stack4d_S020_rotate.nii.gz',...
            'sn7602_constable_stack4d_S019_rotate.nii.gz',...
            'sn7915_constable_stack4d_S019_rotate.nii.gz',...            
            'R_sn7915_constable_stack4d_S019.nii.gz',...     
            'R_sn8002_constable_stack4d_S022.nii.gz',...
            'R_sn8333_constable_stack4d_S024.nii.gz',...
            'R_sn8252_constable_stack4d_S018.nii.gz',...
            'sn8035_constable_stack4d_S019_rotate.nii.gz',...
            'sn8133_constable_stack4d_S016_rotate.nii.gz',...
            'sn8440_constable_stack4d_S020_rotate.nii.gz',...
            'R_Asn8556_constable_stack4d_S018_rotate.nii.gz',...
            'sn8578_constable_stack4d_S018_rotate.nii.gz'};

        % Set the input arguments
        configfile='/ImagePTE1/brainsuite/Woojae/Analysis/bfp/supp_data/config_bfp_preproc.ini';

        t1 = ['/ImagePTE1/brainsuite/Woojae/Analysis/Epilepsy/Raw_Yale/',fd{i},'/',T1{i}];
        fmri = ['/ImagePTE1/brainsuite/Woojae/Analysis/Epilepsy/Raw_Yale/',fd{i},'/',fMRI{i}];
        studydir='/ImagePTE1/brainsuite/Woojae/Analysis/Epilepsy/Output_Yale';
        subid= fd{i};
        sessionid='rest';
        TR='';

        % Call the bfp function
        bfp(configfile, t1, fmri, studydir, subid, sessionid,TR);

        clc;clear all;close all;

    catch
        save(['/ImagePTE1/brainsuite/Woojae/Analysis/Epilepsy/Output_Yale/',fd{i},'/Error.txt']);

        clc;clear all;close all;
    end
end